<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <title>System Accounting - Claims</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;max-width:900px;margin:30px auto;padding:0 16px;}
    h1{font-size:20px;margin:0 0 16px}
    .card{border:1px solid #eee;border-radius:10px;padding:16px;margin:12px 0;background:#fafafa}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid #eee;padding:8px;text-align:left;font-size:14px}
    .badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#eef;color:#334}
  </style>
  <!-- Supabase JS CDN v2 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>ğŸ“’ æˆ‘çš„è´¦å•ï¼ˆæ¼”ç¤ºç‰ˆï¼‰</h1>
  <div class="card">
    <div id="status">æ­£åœ¨ä» Supabase è¯»å–æ•°æ®â€¦</div>
    <table id="tbl" style="display:none">
      <thead>
      <tr>
        <th>ID</th>
        <th>æäº¤äºº</th>
        <th>é‡‘é¢</th>
        <th>ç”¨é€”</th>
        <th>é“¶è¡Œ</th>
        <th>è´¦æˆ·</th>
        <th>çŠ¶æ€</th>
        <th>åˆ›å»ºæ—¶é—´</th>
      </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </div>

  <script>
    // 1) ç”¨ä½ çš„ URL å’Œ anon key æ›¿æ¢ä¸‹é¢ä¸¤è¡Œ
    const SUPABASE_URL = "https://jdzytjocdkuzjtuwygdl.supabase.co";           // ä¾‹å¦‚ï¼šhttps://jdzytjocdkuzjtuwygdl.supabase.co
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impkenl0am9jZGt1emp0dXd5Z2RsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2MjA2MjgsImV4cCI6MjA3NjE5NjYyOH0.jP-CwOVxYhfHXGOz_l_Q7Xc-umLIcJQH0_LJZSUAxNw"; // ä½ çš„ anon key

    // 2) åˆå§‹åŒ–å®¢æˆ·ç«¯
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // 3) è¯»å– claims è¡¨å¹¶æ¸²æŸ“
    async function loadClaims(){
      const status = document.getElementById('status');
      const table = document.getElementById('tbl');
      const tbody = document.getElementById('rows');
      status.textContent = "æ­£åœ¨åŠ è½½â€¦";

      const { data, error } = await supabase
        .from('claims')
        .select('*')
        .order('created_at', { ascending: false });

      if (error) {
        status.textContent = "è¯»å–å¤±è´¥ï¼š" + error.message;
        console.error(error);
        return;
      }

      status.style.display = 'none';
      table.style.display = '';

      tbody.innerHTML = (data || []).map(r => `
        <tr>
          <td>${r.id}</td>
          <td>${r.submitter_name || ''}</td>
          <td>${Number(r.amount).toFixed(2)}</td>
          <td>${r.purpose || ''}</td>
          <td>${r.bank_name || ''}</td>
          <td>${r.account_no || ''}</td>
          <td><span class="badge">${r.status}</span></td>
          <td>${new Date(r.created_at).toLocaleString()}</td>
        </tr>
      `).join('');
    }

    loadClaims();
  </script>
</body>
</html>
